<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Willkommen bei uns!</title>

<style>
  :root{
    --agave:#2e5d50;
    --agaveDark:#244d43;
    --gold:#c7a96b;
    --ink:#1d2b27;
    --muted: rgba(29,43,39,.62);
    --bg1:#f3f0ea;
    --bg2:#e7efe9;
    --shadow: 0 18px 50px rgba(0,0,0,.10);
    --radius: 28px;
    --danger:#b8453b;
  }

  *{ box-sizing:border-box; }
  html{ scroll-behavior:smooth; }
  body{
    margin:0;
    font-family: system-ui,-apple-system,Segoe UI,Roboto,Arial;
    color:var(--ink);
    background:
      radial-gradient(900px 500px at 50% 0%, rgba(46,93,80,.10), transparent 60%),
      radial-gradient(700px 400px at 25% 30%, rgba(199,169,107,.12), transparent 55%),
      linear-gradient(180deg, var(--bg2), var(--bg1));
    display:flex;
    align-items:flex-start;
    justify-content:center;
    padding:34px 16px 40px;
  }

  .wrap{ width:min(460px, 100%); text-align:center; }

  h1{
    margin: 6px 0 10px;
    font-size: clamp(30px, 6vw, 44px);
    letter-spacing: -.3px;
    font-weight: 900;
  }
  .subtitle{
    margin: 0 0 22px;
    color: var(--muted);
    line-height:1.35;
    font-size: 17px;
  }

  .card{
    margin: 18px auto 0;
    background: rgba(255,255,255,.72);
    border: 1px solid rgba(255,255,255,.70);
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    backdrop-filter: blur(12px);
    padding: 20px 18px 18px;
    position:relative;
    overflow:hidden;
  }

  .card::before{
    content:"";
    position:absolute;
    inset:-120px -60px auto -60px;
    height:240px;
    background: radial-gradient(circle at 50% 50%, rgba(199,169,107,.18), transparent 60%);
    pointer-events:none;
  }

  .wifiIcon{
    width:72px;
    height:72px;
    margin: 8px auto 10px;
    border-radius: 22px;
    background: linear-gradient(180deg, rgba(46,93,80,.18), rgba(46,93,80,.08));
    border: 1px solid rgba(46,93,80,.14);
    display:flex;
    align-items:center;
    justify-content:center;
    box-shadow: 0 16px 30px rgba(46,93,80,.10);
  }
  .wifiIcon svg{ width:34px; height:34px; opacity:.95; }

  .ssid{
    margin: 6px 0 4px;
    font-size: 26px;
    font-weight: 900;
    letter-spacing: -.2px;
  }
  .note{
    margin: 0 0 14px;
    color: var(--muted);
    font-size: 15px;
  }

  /* ===== Unlock area ===== */
  .unlockArea{
    position:relative;
    width:220px;
    height:220px;
    margin:18px auto 6px;
    display:flex;
    align-items:center;
    justify-content:center;
    cursor:pointer;
    user-select:none;
    -webkit-tap-highlight-color: transparent;
  }

  .circleGlass{
    position:absolute;
    width:190px;
    height:190px;
    border-radius:50%;
    background: radial-gradient(circle at 50% 45%,
      rgba(255,255,255,.92) 0%,
      rgba(255,255,255,.80) 40%,
      rgba(255,255,255,.55) 66%,
      rgba(255,255,255,.18) 84%,
      rgba(255,255,255,0) 100%);
    box-shadow:
      inset 0 0 0 18px rgba(46,93,80,.035),
      0 26px 50px rgba(0,0,0,.11);
    border: 1px solid rgba(0,0,0,.03);
    z-index:2;
  }

  .fingerBg{
    position:absolute;
    width:96px;
    height:96px;
    object-fit:contain;
    opacity:1;
    z-index:3;
    transform: translateY(-6px);
    filter:
      drop-shadow(0 10px 18px rgba(0,0,0,.14))
      contrast(1.25)
      saturate(1.05);
  }

  .tapText{
    margin-top:8px;
    text-align:center;
    background: rgba(255,255,255,.72);
    border: 1px solid rgba(0,0,0,.05);
    border-radius:999px;
    padding:10px 22px;
    font-weight: 700;
    color: rgba(29,43,39,.62);
    display:inline-block;
    box-shadow: 0 12px 26px rgba(0,0,0,.08);
  }

  .tapGlow{
    position:absolute;
    inset:-10px;
    border-radius:999px;
    background: radial-gradient(circle at 50% 50%, rgba(199,169,107,.22), transparent 58%);
    opacity:0;
    filter: blur(2px);
    z-index:1;
    pointer-events:none;
  }

  .qrLayer{
    position:absolute;
    inset:0;
    display:flex;
    align-items:center;
    justify-content:center;
    z-index:4;
    opacity:0;
    transform: scale(.92) translateY(10px);
    filter: blur(14px);
    pointer-events:none;
  }
  .qrLayer.show{
    opacity:1;
    transform: scale(1) translateY(0);
    filter: blur(0);
    transition: opacity .65s cubic-bezier(.2,.9,.2,1),
                transform .65s cubic-bezier(.2,.9,.2,1),
                filter .65s cubic-bezier(.2,.9,.2,1);
  }

  .qrImg{
    width: 198px;
    height:auto;
    border-radius: 18px;
    background:#fff;
    padding: 14px;
    box-shadow: 0 18px 40px rgba(0,0,0,.14);
    border: 1px solid rgba(0,0,0,.05);
  }

  .qrHint{
    margin: 10px 0 0;
    font-size: 13px;
    color: rgba(29,43,39,.62);
    display:none;
    line-height:1.35;
  }

  /* STEP 2 */
  .btnPrimary{
    display:block;
    width:100%;
    border-radius: 18px;
    padding: 16px 14px;
    font-size: 16px;
    font-weight: 900;
    text-decoration:none;
    text-align:center;
    background: linear-gradient(180deg, var(--agave), var(--agaveDark));
    color:#fff;
    box-shadow: 0 16px 34px rgba(46,93,80,.22);
  }
  .btnPrimary[aria-disabled="true"]{
    opacity:.45;
    pointer-events:none;
  }

  .step2{
    margin-top:20px;
    opacity:0;
    transform: translateY(16px);
    filter: blur(8px);
    pointer-events:none;
    transition: opacity .55s cubic-bezier(.2,.9,.2,1),
                transform .55s cubic-bezier(.2,.9,.2,1),
                filter .55s cubic-bezier(.2,.9,.2,1);
  }
  .step2.show{
    opacity:1;
    transform: translateY(0);
    filter: blur(0);
    pointer-events:auto;
  }

  /* Tap effect */
  .unlockArea.pressed .tapGlow{
    opacity:1;
    animation: glowPulse .9s ease-out forwards;
  }
  .unlockArea.pressed .fingerBg{
    animation: fingerPulse .38s cubic-bezier(.2,.9,.2,1) forwards;
  }
  @keyframes fingerPulse{
    0%{ transform: translateY(-6px) scale(1); }
    60%{ transform: translateY(-8px) scale(1.06); }
    100%{ transform: translateY(-6px) scale(1); }
  }
  @keyframes glowPulse{
    0%{ opacity:0; transform: scale(.92); }
    40%{ opacity:1; transform: scale(1); }
    100%{ opacity:0; transform: scale(1.10); }
  }

  .unlockArea.qrShown .fingerBg{
    animation: fingerFadeOut .55s cubic-bezier(.2,.9,.2,1) forwards;
  }
  @keyframes fingerFadeOut{
    0%{ opacity:1; transform: translateY(-6px) scale(1); filter: blur(0); }
    55%{ opacity:.35; transform: translateY(-10px) scale(1.06); }
    100%{ opacity:0; transform: translateY(10px) scale(.92); filter: blur(8px); }
  }

  /* Locked feedback */
  .unlockArea.locked{
    cursor:not-allowed;
  }
  .unlockArea.locked .fingerBg{
    opacity:.85;
    filter:
      drop-shadow(0 10px 18px rgba(0,0,0,.14))
      contrast(1.15)
      saturate(.85);
  }
  .lockBadge{
    display:none;
    margin-top:10px;
    color: var(--danger);
    font-weight: 800;
    font-size: 13px;
  }
  .lockBadge.show{ display:block; }

  .shake{
    animation: shake .32s ease-in-out;
  }
  @keyframes shake{
    0%{ transform: translateX(0); }
    25%{ transform: translateX(-6px); }
    50%{ transform: translateX(6px); }
    75%{ transform: translateX(-4px); }
    100%{ transform: translateX(0); }
  }

  /* Cool scroll overlay */
  .scrollOverlay{
    position:fixed;
    inset:0;
    pointer-events:none;
    opacity:0;
    background: radial-gradient(circle at 50% 30%, rgba(199,169,107,.18), rgba(46,93,80,.10), rgba(0,0,0,0));
    backdrop-filter: blur(10px);
    transition: opacity .35s ease;
    z-index:999;
  }
  .scrollOverlay.show{ opacity:1; }

  /* Micro snap bounce */
  .microSnap{
    animation: microSnap .42s cubic-bezier(.2,.9,.2,1);
  }
  @keyframes microSnap{
    0%{ transform: translateY(0); }
    55%{ transform: translateY(-6px); }
    100%{ transform: translateY(0); }
  }
</style>
</head>

<body>
<div class="scrollOverlay" id="scrollOverlay"></div>

<div class="wrap" id="wrap">
  <h1>Willkommen bei uns!</h1>
  <div class="subtitle">Schön, dass ihr da seid. Verbindet euch direkt mit unserem Netz.</div>

  <!-- STEP 1 -->
  <div class="card" id="step1Card">
    <div class="wifiIcon" aria-hidden="true">
      <svg viewBox="0 0 24 24" fill="none">
        <path d="M2.5 8.5C8.5 3.5 15.5 3.5 21.5 8.5" stroke="rgba(46,93,80,.92)" stroke-width="2.2" stroke-linecap="round"/>
        <path d="M5.5 11.5C10 7.8 14 7.8 18.5 11.5" stroke="rgba(46,93,80,.92)" stroke-width="2.2" stroke-linecap="round"/>
        <path d="M8.7 14.6C11 12.8 13 12.8 15.3 14.6" stroke="rgba(46,93,80,.92)" stroke-width="2.2" stroke-linecap="round"/>
        <circle cx="12" cy="18" r="1.6" fill="rgba(46,93,80,.92)"/>
      </svg>
    </div>

    <div class="ssid" id="wifiTarget">Pretty fly for a WIFI</div>
    <div class="note" id="noteText">Tippe auf den Fingerabdruck – dann erscheint der QR-Code.</div>

    <div class="unlockArea locked" id="unlockArea" role="button" tabindex="0" aria-label="QR anzeigen">
      <div class="tapGlow" id="tapGlow"></div>
      <div class="circleGlass"></div>
      <img src="fingerprint.png" class="fingerBg" alt="Fingerprint">
      <div class="qrLayer" id="qrLayer" aria-hidden="true">
        <img class="qrImg" src="IMG_2088.png" alt="WLAN QR Code">
      </div>
    </div>

    <div class="tapText" id="tapText">Gesperrt</div>
    <div class="lockBadge" id="lockBadge">Bitte nur über den NFC-Tag öffnen.</div>

    <div class="qrHint" id="qrHint">
      QR scannen → WLAN beitreten.<br>
      (Falls das Handy fragt: „Netzwerk beitreten?“ → Ja.)
    </div>
  </div>

  <!-- STEP 2 -->
  <div class="card step2" id="step2Card">
    <div class="wifiIcon" aria-hidden="true" style="
         background: linear-gradient(180deg, rgba(199,169,107,.20), rgba(199,169,107,.08));
         border-color: rgba(199,169,107,.25);">
      <svg viewBox="0 0 24 24" fill="none">
        <path d="M4 5c0-1.1.9-2 2-2h10a2 2 0 0 1 2 2v14a1 1 0 0 0-1-1H6a2 2 0 0 0-2 2V5z"
              stroke="rgba(46,93,80,.92)" stroke-width="2" stroke-linejoin="round"/>
        <path d="M6 3v14" stroke="rgba(46,93,80,.92)" stroke-width="2"/>
      </svg>
    </div>

    <div class="ssid" style="font-size:24px;">Weiter</div>
    <div class="note">Wenn du mit dem WLAN verbunden bist, geht’s hier weiter.</div>

    <a class="btnPrimary" id="guestbookBtn" href="#" aria-disabled="true">Gästebuch öffnen</a>
  </div>
</div>

<script>
  // ====== CONFIG ======
  const SSID = "Pretty fly for a WIFI";
  const GUESTBOOK_URL = "guestbook-wall.html";

  /**
   * Trage hier die erlaubten Token-Hashes (SHA-256 HEX) ein.
   * Du kannst mehrere Tokens zulassen (z.B. falls du NFC-Tags neu schreibst).
   *
   * So erzeugst du einen Hash:
   * - Öffne die Seite einmal, Browser-Konsole:
   *   await sha256Hex("DEIN-TOKEN")
   * - Den HEX-Wert hier eintragen.
   */
  const ALLOWED_TOKEN_SHA256_HEX = [
    // Beispiel (ersetzen!):
    "f26146a4696ed4a1768bd9cd7018fd2a42d2ee9741109b221d38d97638f36a95"
    // "2c26b46b68ffc68ff99b453c1d30413413422d706483bfa0f98a5e886266e7ae"
  ];
  // ====================

  document.getElementById('wifiTarget').textContent = SSID;
  const guestBtn = document.getElementById('guestbookBtn');
  guestBtn.href = GUESTBOOK_URL;

  const unlockArea = document.getElementById('unlockArea');
  const tapText = document.getElementById('tapText');
  const qrHint = document.getElementById('qrHint');
  const step2Card = document.getElementById('step2Card');
  const overlay = document.getElementById('scrollOverlay');
  const qrLayer = document.getElementById('qrLayer');
  const wifiTarget = document.getElementById('wifiTarget');
  const wrap = document.getElementById('wrap');
  const lockBadge = document.getElementById('lockBadge');
  const noteText = document.getElementById('noteText');

  let revealed = false;
  let tokenOk = false;

  // ---- Token helpers ----
  function parseTokenFromUrl() {
    // Unterstützt:
    // 1) ?t=TOKEN
    // 2) #t=TOKEN (empfohlen, taucht weniger in Logs auf)
    const url = new URL(window.location.href);

    const q = url.searchParams.get("t");
    if (q) return q;

    const h = (url.hash || "").replace(/^#/, "");
    if (!h) return null;

    // Einfaches parsing: "t=..." oder "...&t=..."
    const params = new URLSearchParams(h);
    return params.get("t");
  }

  function toHex(buf) {
    const bytes = new Uint8Array(buf);
    let out = "";
    for (const b of bytes) out += b.toString(16).padStart(2, "0");
    return out;
  }

  async function sha256Hex(str) {
    const enc = new TextEncoder();
    const buf = await crypto.subtle.digest("SHA-256", enc.encode(str));
    return toHex(buf);
  }

  async function checkToken() {
    // Wenn keine Allowlist gepflegt wird, sperren wir hart.
    if (!Array.isArray(ALLOWED_TOKEN_SHA256_HEX) || ALLOWED_TOKEN_SHA256_HEX.length === 0) {
      return false;
    }
    const token = parseTokenFromUrl();
    if (!token) return false;

    const hash = await sha256Hex(token.trim());
    return ALLOWED_TOKEN_SHA256_HEX.includes(hash);
  }

  // ---- Scroll helpers (wie vorher) ----
  function getTargetY(el, topPaddingPx = 10){
    const rect = el.getBoundingClientRect();
    return window.scrollY + rect.top - topPaddingPx;
  }

  function afterScroll(cb){
    let last = window.scrollY;
    let stableCount = 0;
    const start = Date.now();

    function tick(){
      const now = window.scrollY;
      if (Math.abs(now - last) < 2) stableCount++;
      else stableCount = 0;

      last = now;

      if (stableCount >= 6 || (Date.now() - start) > 1400) cb();
      else requestAnimationFrame(tick);
    }
    requestAnimationFrame(tick);
  }

  function microScrollSnapTo(el){
    overlay.classList.add('show');

    const baseY = getTargetY(el, 10);
    const overshoot = 10;
    const up = Math.max(0, baseY - overshoot);

    window.scrollTo({ top: up, behavior: 'smooth' });

    afterScroll(() => {
      window.scrollTo({ top: baseY, behavior: 'auto' });

      wrap.classList.remove('microSnap');
      void wrap.offsetWidth;
      wrap.classList.add('microSnap');

      setTimeout(() => overlay.classList.remove('show'), 420);
    });
  }

  // ---- UI gating ----
  function setLockedUI() {
    tokenOk = false;
    unlockArea.classList.add("locked");
    lockBadge.classList.add("show");
    tapText.textContent = "Gesperrt";
    noteText.textContent = "Bitte über den NFC-Tag öffnen.";
    guestBtn.setAttribute("aria-disabled", "true");
  }

  function setUnlockedUI() {
    tokenOk = true;
    unlockArea.classList.remove("locked");
    lockBadge.classList.remove("show");
    tapText.textContent = "Tippe auf den Fingerabdruck";
    noteText.textContent = "Tippe auf den Fingerabdruck – dann erscheint der QR-Code.";
    guestBtn.setAttribute("aria-disabled", "false");
  }

  function lockedFeedback() {
    unlockArea.classList.add("shake");
    setTimeout(() => unlockArea.classList.remove("shake"), 350);
  }

  async function init() {
    const ok = await checkToken();
    if (ok) setUnlockedUI();
    else setLockedUI();
  }

  function revealSequence(){
    if (!tokenOk) { lockedFeedback(); return; }
    if (revealed) return;
    revealed = true;

    unlockArea.classList.add('pressed');
    tapText.textContent = "Weiter …";

    setTimeout(() => step2Card.classList.add('show'), 220);

    setTimeout(() => {
      microScrollSnapTo(wifiTarget);

      afterScroll(() => {
        unlockArea.classList.add('qrShown');
        qrLayer.classList.add('show');
        qrHint.style.display = "block";
        tapText.textContent = "QR wird angezeigt …";
      });
    }, 240);
  }

  unlockArea.addEventListener('click', revealSequence);
  unlockArea.addEventListener('keydown', (e) => {
    if (e.key === "Enter" || e.key === " ") revealSequence();
  });

  // Start
  init();

  // Für dich zum Hashen im Browser:
  // (Konsole) await sha256Hex("DEIN-TOKEN")
  window.sha256Hex = sha256Hex;
</script>
</body>
</html>
