<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Unser digitales G√§stebuch</title>

<style>
  :root{
    --agave:#2e5d50;
    --gold:#c7a96b;
    --ink:#1d2b27;
    --bg1:#e7efe9;
    --bg2:#f4f1ea;
    --card:#ffffff;
    --shadow: 0 14px 34px rgba(0,0,0,.06);
  }
  *{ box-sizing:border-box; }
  html{ scroll-behavior:smooth; }
  body{
    font-family: system-ui,-apple-system,Segoe UI,Roboto,Arial;
    margin:0;
    padding:40px 18px;
    color:var(--ink);
    background: linear-gradient(180deg,var(--bg1),var(--bg2));
    text-align:center;
  }
  .wrap{ max-width:920px; margin:0 auto; }

  h1{ margin:0 0 8px; font-size:34px; letter-spacing:.2px; }
  .subtitle{ opacity:.75; margin:0 0 28px; line-height:1.35; }

  .hero{
    background: rgba(255,255,255,.55);
    border: 1px solid rgba(255,255,255,.6);
    border-radius: 26px;
    padding: 18px 18px 22px;
    box-shadow: var(--shadow);
    backdrop-filter: blur(10px);
  }

  /* Gate card */
  .gate{
    margin-top: 14px;
    padding: 14px;
    border-radius: 18px;
    background: rgba(46,93,80,.08);
    border: 1px solid rgba(46,93,80,.12);
    display:none;
  }
  .gate.show{ display:block; }
  .gateTitle{ font-weight:800; color: var(--agave); margin: 2px 0 6px; }
  .gateText{ margin: 0; opacity:.78; line-height:1.35; }

  /* Slider */
  .sliderShell{
    margin: 18px auto 6px;
    max-width: 520px;
    background: rgba(46,93,80,.10);
    border: 1px solid rgba(46,93,80,.12);
    border-radius: 999px;
    padding: 10px;
    position: relative;
    overflow:hidden;
    display:none;
  }
  .sliderShell.show{ display:block; }

  .shine{
    position:absolute;
    inset:-40px;
    background: linear-gradient(110deg, transparent 0%, rgba(255,255,255,.22) 45%, rgba(255,255,255,.06) 55%, transparent 100%);
    transform: translateX(-60%);
    animation: shine 2.8s ease-in-out infinite;
    pointer-events:none;
  }
  @keyframes shine{
    0%{ transform: translateX(-65%); }
    60%{ transform: translateX(65%); }
    100%{ transform: translateX(65%); }
  }

  .range{
    width:100%;
    appearance:none;
    background: transparent;
    height: 44px;
    margin:0;
    position: relative;
    z-index:2;
  }
  .range::-webkit-slider-thumb{
    appearance:none;
    width: 56px;
    height: 56px;
    border-radius: 18px;
    background: linear-gradient(180deg,var(--agave),#244d43);
    box-shadow: 0 10px 22px rgba(46,93,80,.25);
    border: 2px solid rgba(255,255,255,.75);
    cursor: grab;
  }
  .range:active::-webkit-slider-thumb{ cursor: grabbing; }

  .trackText{
    position:absolute;
    inset:0;
    display:flex;
    align-items:center;
    justify-content:center;
    gap:10px;
    font-weight: 650;
    color: rgba(29,43,39,.72);
    z-index:1;
    user-select:none;
    pointer-events:none;
  }

  .lockIcon{
    width:16px; height:16px;
    display:inline-block;
    border: 2px solid rgba(29,43,39,.55);
    border-radius: 4px;
    position: relative;
    transform: translateY(1px);
  }
  .lockIcon::before{
    content:"";
    position:absolute;
    width: 10px; height: 8px;
    left:50%; transform:translateX(-50%);
    top:-9px;
    border: 2px solid rgba(29,43,39,.55);
    border-bottom:none;
    border-radius: 8px 8px 0 0;
  }

  .hint{ font-size:13px; opacity:.7; margin-top: 10px; }

  /* Reveal */
  .reveal{ margin-top: 22px; display:none; }
  .reveal.show{ display:block; }

  .grid{
    display:grid;
    grid-template-columns: 1fr 1fr;
    gap: 18px;
    margin-top: 16px;
  }
  @media (max-width: 720px){ .grid{ grid-template-columns: 1fr; } }

  .card{
    background: var(--card);
    border-radius: 22px;
    box-shadow: var(--shadow);
    padding: 22px;
    text-align:center;
    transform-origin: top center;
    opacity:0;
    transform: translateY(22px) scale(.98);
    filter: blur(6px);
  }
  .reveal.show .card{ animation: rollUp .75s cubic-bezier(.2,.9,.2,1) forwards; }
  .reveal.show .card:nth-child(2){ animation-delay: .12s; }

  @keyframes rollUp{
    0%{ opacity:0; transform: translateY(28px) scale(.98); filter: blur(8px); }
    60%{ opacity:1; transform: translateY(-2px) scale(1.01); filter: blur(0); }
    100%{ opacity:1; transform: translateY(0) scale(1); filter: blur(0); }
  }

  .tag{
    display:inline-flex;
    align-items:center;
    gap:8px;
    padding: 7px 12px;
    border-radius: 999px;
    background: rgba(199,169,107,.16);
    color: rgba(29,43,39,.86);
    font-size: 13px;
    font-weight: 650;
    margin-bottom: 14px;
  }
  .dot{
    width:10px; height:10px; border-radius:999px;
    background: linear-gradient(180deg,var(--gold),#b69145);
    box-shadow: 0 6px 14px rgba(199,169,107,.25);
  }

  .qr{
    width: 240px;
    max-width: 70vw;
    border-radius: 16px;
    display:block;
    margin: 10px auto 12px;
  }

  .title{ margin: 2px 0 6px; font-size: 20px; color: var(--agave); font-weight: 750; }
  .text{ margin: 0; opacity:.72; line-height:1.35; }

  .actions{
    margin-top: 14px;
    display:flex;
    justify-content:center;
    gap: 10px;
    flex-wrap: wrap;
  }

  .btn{
    display:inline-flex;
    align-items:center;
    justify-content:center;
    padding: 12px 18px;
    border-radius: 14px;
    border: 1px solid rgba(46,93,80,.16);
    background: rgba(46,93,80,.08);
    color: var(--agave);
    font-weight: 700;
    text-decoration:none;
  }
  .btnPrimary{
    background: linear-gradient(180deg,var(--agave),#244d43);
    color: white;
    border: none;
    box-shadow: 0 10px 22px rgba(46,93,80,.22);
  }

  .sparkle{
    display:none;
    margin: 14px auto 0;
    width: 160px;
    height: 18px;
    background:
      radial-gradient(circle at 10% 50%, rgba(199,169,107,.9) 0 2px, transparent 3px),
      radial-gradient(circle at 30% 35%, rgba(46,93,80,.6) 0 2px, transparent 3px),
      radial-gradient(circle at 55% 55%, rgba(199,169,107,.8) 0 2px, transparent 3px),
      radial-gradient(circle at 80% 40%, rgba(46,93,80,.55) 0 2px, transparent 3px);
    opacity:.8;
    filter: blur(.1px);
    animation: twinkle 1.4s ease-in-out infinite;
  }
  .sparkle.show{ display:block; }
  @keyframes twinkle{
    0%,100%{ transform: translateY(0); opacity:.65; }
    50%{ transform: translateY(-2px); opacity:.95; }
  }

  .scrollOverlay{
    position:fixed;
    inset:0;
    pointer-events:none;
    opacity:0;
    background: radial-gradient(circle at 50% 30%, rgba(199,169,107,.18), rgba(46,93,80,.10), rgba(0,0,0,0));
    backdrop-filter: blur(8px);
    transition: opacity .35s ease;
    z-index:999;
  }
  .scrollOverlay.show{ opacity:1; }
</style>
</head>

<body>
<div class="scrollOverlay" id="scrollOverlay"></div>

<div class="wrap">
  <div class="hero" id="top">
    <h1>Unser digitales G√§stebuch</h1>
    <p class="subtitle">Hinterlasse uns eine Nachricht, ein Foto und deinen Lieblingssong ‚ú®</p>

    <!-- Gate message when token missing/invalid -->
    <div class="gate" id="gate">
      <div class="gateTitle">Zugang gesperrt</div>
      <p class="gateText">
        Bitte nutze den NFC-Tag am Eingang, damit die QR-Codes angezeigt werden.
      </p>
    </div>

    <!-- Slider only shows when token is valid -->
    <div class="sliderShell" id="sliderShell">
      <div class="shine"></div>
      <div class="trackText">
        <span class="lockIcon" aria-hidden="true"></span>
        <span id="trackLabel">Slide to unlock</span>
      </div>
      <input class="range" id="unlock" type="range" min="0" max="100" value="0" />
    </div>

    <div class="hint" id="hint">Schiebe den Regler nach rechts ‚Äì dann erscheinen die QR-Codes.</div>
    <div class="sparkle" id="sparkle"></div>
  </div>

  <div class="reveal" id="reveal">
    <div class="grid" id="qrSection">
      <div class="card">
        <div class="tag"><span class="dot"></span> Schritt 1</div>
        <div class="title">Mit Gast-WLAN verbinden</div>
        <img src="Qr_qrcode.png" class="qr" alt="WLAN QR Code">
        <p class="text">QR scannen ‚Üí WLAN beitreten.</p>
      </div>

      <div class="card">
        <div class="tag"><span class="dot"></span> Schritt 2</div>
        <div class="title">G√§stebuch √∂ffnen</div>
        <p class="text">Wenn du im WLAN bist, kannst du hier direkt starten:</p>

        <div class="actions">
          <a class="btn btnPrimary" id="guestbookBtn" href="#">G√§stebuch √∂ffnen</a>
          <a class="btn" href="#" id="resetBtn">Zur√ºcksetzen</a>
        </div>

        <p class="hint" style="margin-top:12px;">
          (Der Link funktioniert nur im richtigen WLAN.)
        </p>
      </div>
    </div>
  </div>
</div>

<script>
  // ====== KONFIG ======
  // NFC URL Beispiel:
  // https://USERNAME.github.io/guestbook/?t=HENRIK2026
  const ALLOWED_TOKENS = new Set([
    "HENRIK2026"
    // weitere Tokens m√∂glich: "HENRIK2026A", "HENRIK2026B"
  ]);

  // Lokaler G√§stebuch-Link (im Gastnetz erreichbar, z.B. ioBroker):
  const GUESTBOOK_URL = "http://192.168.178.50:8082/guestbook/";
  // ====================

  const unlock = document.getElementById('unlock');
  const reveal = document.getElementById('reveal');
  const trackLabel = document.getElementById('trackLabel');
  const hint = document.getElementById('hint');
  const sparkle = document.getElementById('sparkle');
  const resetBtn = document.getElementById('resetBtn');
  const qrSection = document.getElementById('qrSection');
  const overlay = document.getElementById('scrollOverlay');
  const gate = document.getElementById('gate');
  const sliderShell = document.getElementById('sliderShell');
  const guestbookBtn = document.getElementById('guestbookBtn');

  guestbookBtn.href = GUESTBOOK_URL;

  let unlocked = false;

  function coolScrollTo(el){
    overlay.classList.add('show');
    setTimeout(() => {
      el.scrollIntoView({ behavior: 'smooth', block: 'start' });
      setTimeout(() => overlay.classList.remove('show'), 650);
    }, 120);
  }

  function doUnlock(){
    if (unlocked) return;
    unlocked = true;
    reveal.classList.add('show');
    sparkle.classList.add('show');
    trackLabel.textContent = "Unlocked";
    hint.textContent = "Perfekt! Jetzt Schritt 1 ‚Üí dann G√§stebuch √∂ffnen.";
    unlock.disabled = true;
    setTimeout(() => coolScrollTo(qrSection), 220);
  }

  unlock.addEventListener('input', () => {
    const v = Number(unlock.value || 0);
    if (v > 8 && !unlocked) trackLabel.textContent = "Weiter schieben ‚Ä¶";
    if (v >= 95) doUnlock();
  });

  unlock.addEventListener('change', () => {
    if (!unlocked) {
      unlock.value = 0;
      trackLabel.textContent = "Slide to unlock";
    }
  });

  resetBtn.addEventListener('click', (e) => {
    e.preventDefault();
    unlocked = false;
    unlock.disabled = false;
    unlock.value = 0;
    reveal.classList.remove('show');
    sparkle.classList.remove('show');
    trackLabel.textContent = "Slide to unlock";
    hint.textContent = "Schiebe den Regler nach rechts ‚Äì dann erscheinen die QR-Codes.";
    coolScrollTo(document.getElementById('top'));
  });

  // ====== TOKEN CHECK (soft gate) ======
  function getToken(){
    const params = new URLSearchParams(window.location.search);
    return (params.get('t') || "").trim();
  }

  const token = getToken();
  const valid = token && ALLOWED_TOKENS.has(token);

  if (!valid){
    // Ohne Token: Slider verstecken, Gate anzeigen
    gate.classList.add('show');
    sliderShell.classList.remove('show');
    hint.textContent = "Halte dein Handy an den NFC-Tag, um fortzufahren.";
  } else {
    // Mit Token: Slider anzeigen
    sliderShell.classList.add('show');
    gate.classList.remove('show');

    // Optional: Token aus der URL entfernen, damit man ihn nicht so leicht sieht (nice-to-have)
    // Das ist keine echte Sicherheit, aber sch√∂ner.
    try{
      const cleanUrl = window.location.origin + window.location.pathname;
      window.history.replaceState({}, "", cleanUrl);
    } catch(e){}

    // Optional: Wenn du willst, dass es automatisch ‚Äúready‚Äù wirkt:
    hint.textContent = "Willkommen! Slide to unlock üôÇ";
  }
</script>
</body>
</html>